(this["webpackJsonpeffectnode-3dworld-example"]=this["webpackJsonpeffectnode-3dworld-example"]||[]).push([[0],{41:function(e,n,t){e.exports=t(55)},42:function(e,n,t){},55:function(e,n,t){"use strict";t.r(n);t(42);var o=t(6),r=t.n(o),a=t(34),i=t.n(a),l=t(11),c=t(60),s=t(63),u=t(0),v=t(62),f=t(35),d=t(36),m=t(37),p=t(61),g=t(15),x=function(e){void 0===e&&(e={});var n="_"+Math.random().toString(36).substr(2,9)+Math.random().toString(36).substr(2,9),t={exportJSON:function(){return JSON.parse(JSON.stringify(e))},getNameSpcaeID:function(){return n},onEvent:function(t,o){var r=""+n,a=function(){o(e[t])};return window.addEventListener(r+"-"+t,a),function(){window.removeEventListener(r+"-"+t,a)}},makeKeyReactive:function(e){var t=Object(o.useState)(0),r=t[0],a=t[1];Object(o.useEffect)((function(){var t=""+n,o=function(){a((function(e){return e+1}))};return window.addEventListener(t+"-"+e,o),function(){window.removeEventListener(t+"-"+e,o)}}),[r])},reloadKey:function(e){window.dispatchEvent(new CustomEvent(n+"-"+e,{detail:{}}))}};return new Proxy(e,{get:function(e,n){return t[n]?t[n]:e[n]},set:function(e,t,o){return e[t]!==o&&(e[t]=o,"undefined"!==typeof window&&window.dispatchEvent(new CustomEvent(n+"-"+t,{detail:{}}))),!0}})},y=function(e){var n=this,t=e.parent,o=void 0!==t&&t;this.parent=o,this.resource=new Map,this.get=function(e){return new Promise((function(t){var o=0;o=setInterval((function(){n.parent?(n.resource.has(e)||n.parent.resource.has(e))&&(clearInterval(o),t(n.resource.get(e)||n.parent.resource.get(e))):n.resource.has(e)&&(clearInterval(o),t(n.resource.get(e)))}))}))},this.set=function(e,t){n.resource.set(e,t)},this.name="ENMini";var r=!1;this.tasks=[],this.resizeTasks=[],this.cleanTasks=[],this.onLoop=function(e,t){void 0===t&&(t=0),t>=0?n.tasks.push(e):n.tasks.unshift(e)},this.onResize=function(e){e(),n.resizeTasks.push(e)},this.onClean=function(e){n.cleanTasks.push(e)};var a=0;window.addEventListener("resize",(function(){clearTimeout(a),a=setTimeout((function(){n.resizeTasks.forEach((function(e){return e()}))}),16.8888)}));var i=!1;this.toggle=function(){i=!i},this.pause=function(){i=!0},this.play=function(){i=!1},this.clean=function(){r=!0;try{n.cleanTasks.forEach((function(e){return e()}))}catch(e){console.error(e)}},this.lastTime=window.performance.now(),this.work=function(){if(n.timeNow=window.performance.now(),r)return{name:n.name,duration:0};if(i)return{name:n.name,duration:0};var e=window.performance.now();try{var t=n.timeNow,o=n.lastTime,a=t-o;n.lastTime=t,t/=1e3,(a/=1e3)>=100&&(a=100),n.tasks.forEach((function(e){return e(t,a)}))}catch(c){console.error(c)}var l=window.performance.now()-e;return{name:n.name,duration:l}},this.ready=new Proxy({},{get:function(e,t){return n.get(t)}}),this.now=new Proxy({},{get:function(e,t){return n.parent?n.resource.get(t)||n.parent.resource.get(t):n.resource.get(t)}})};function h(){var e=Object(l.d)().get,n=Object(o.useState)((function(){return new y({})}))[0];return Object(o.useEffect)((function(){return function(){n.clean()}}),[]),Object(l.b)((function(){var t=e();for(var o in t)n.set(o,t[o]);n.work()})),{mini:n}}var w=function(e,n,t,r){void 0===t&&(t={passive:!1}),Object(o.useEffect)((function(){return(r=r||window).addEventListener(e,n,t),function(){(r=r||window).removeEventListener(e,n)}}),[])},b=function(e,n,t,o){return void 0===o&&(o={passive:!1}),(e=e||window).addEventListener(n,t,o),function(){(e=e||window).removeEventListener(n,t)}},z=function(){function e(e){var n=e.floor,t=e.scene;this.floor=n,this.center=new u.Vector2(0,0),this.raycaster=new u.Raycaster,this.scene=t;var o=this.makeCollider();this.collider=o,this.preview=o}var n=e.prototype;return n.makeCollider=function(){var e=this.scene,n=this.floor,o=t(51).BufferGeometryUtils,r=t(32).SkeletonUtils.clone(n),a=[];r.updateMatrixWorld(),r.traverse((function(e){if(e.geometry&&!e.userData.isNotFloor){var n=e.geometry.clone();for(var t in n.applyMatrix4(e.matrixWorld),n.attributes)"position"===t||"index"===t||n.deleteAttribute(t);a.push(n)}})),e.traverse((function(e){if(e&&e.userData&&e.userData.isFloor&&e.geometry){var n=e.geometry.clone();for(var t in e.updateMatrixWorld(),n.applyMatrix4(e.matrixWorld),n.attributes)"position"!==t&&n.deleteAttribute(t);a.push(n)}}));var i=o.mergeBufferGeometries(a,!1);i.boundsTree=new v.a(i);var l=new u.Mesh(i,new u.MeshBasicMaterial({color:16777215}));return l.material.wireframe=!0,l.material.opacity=.5,l.material.transparent=!0,l.updateMatrixWorld(),l},n.scanCenter=function(e){var n=e.camera,t=e.scene,o=this.raycaster,r=this.center,a=this.collider;o.setFromCamera(r,n);var i=[],l=[];t.traverse((function(e){e.geometry&&e.userData.isHoverable&&l.push(e)})),o.intersectObjects(l,!1,i),a.geometry.boundsTree.raycastFirst(a,o,o.ray);var c=i[0];return c||!1},e}(),D=function(e){var n=e.collider,o=e.startAt,r=e.Now;r.avatarAt.copy(o),r.goingTo.copy(o),this.collider=n;var a=t(52).RoundedBoxGeometry,i=new u.Mesh(new a(1,2,1,8,1.3),new u.MeshLambertMaterial({transparent:!0,opacity:1}));i.geometry.translate(0,-1.3,0),i.castShadow=!0,i.capsuleInfo={radius:1.3,segment:new u.Line3(new u.Vector3,new u.Vector3(0,-1,0))},this.player=i,i.position.copy(o),i.position.y+=5,i.geometry.computeBoundingBox(),i.collider=(new u.Box3).copy(i.geometry.boundingBox);var l=new u.Vector3,c=new u.Vector3(0,0,0),s=new u.Vector3,v=new u.Vector3,f=new u.Box3,d=new u.Matrix4,m=new u.Line3,p=new u.Object3D;function g(e){var t=e.delta,a=e.player;c.y+=-9.8*t,a.position.addScaledVector(c,t),a.position.y<=-50&&(a.position.copy(o),r.goingTo.copy(o),r.goingTo.z+=1,c.y=0),l.copy(r.goingTo).sub(a.position),l.y=0;var i=l.length();l.normalize(),l.y=0,l.multiplyScalar(r.avatarSpeed),i>=.1?(a.position.addScaledVector(l,.04),r.avatarMode="running"):r.avatarMode="standing",a.updateMatrixWorld();var u=a.capsuleInfo;f.makeEmpty(),d.copy(n.matrixWorld).invert(),m.copy(u.segment),m.start.applyMatrix4(a.matrixWorld).applyMatrix4(d),m.end.applyMatrix4(a.matrixWorld).applyMatrix4(d),f.expandByPoint(m.start),f.expandByPoint(m.end),f.min.addScalar(-u.radius),f.max.addScalar(u.radius),n.geometry.boundsTree.shapecast(n,{intersectsBounds:function(e){return e.intersectsBox(f)},intersectsTriangle:function(e){var n=s,t=v,o=e.closestPointToSegment(m,n,t);if(o<u.radius){var r=u.radius-o,a=t.sub(n).normalize();m.start.addScaledVector(a,r),m.end.addScaledVector(a,r)}}});var g=s;g.copy(m.start).applyMatrix4(n.matrixWorld);var x=v;x.subVectors(g,a.position),a.position.copy(g),r.avatarAt.copy(a.position),p.position.copy(a.position),p.lookAt(r.goingTo.x,a.position.y,r.goingTo.z),r.avatarRot.x=p.rotation.x,r.avatarRot.y=p.rotation.y,r.avatarRot.z=p.rotation.z,x.y>Math.abs(t*c.y*.25)?c.set(0,0,0):(x.normalize(),c.addScaledVector(x,-x.dot(c)))}var x=new u.Clock;this.onSimulate=function(){var e=x.getDelta();e>=1/30&&(e=1/30);for(var n=0;n<4;n++)g({delta:e/4,player:i})}},T=function(e){var n=e.children,t=e.floor,a=e.startAt,i=Object(l.d)().get,c=h().mini,s=Object(o.useRef)(),v=Object(o.useRef)(),f=Object(o.useRef)();return Object(o.useEffect)((function(){var e=s.current=new z({floor:t,scene:i().scene}),n=v.current=x({moved:0,goingTo:new u.Vector3,camAt:new u.Vector3,avatarAt:new u.Vector3,avatarHead:new u.Vector3,avatarRot:new u.Vector3,avatarFaceLook:new u.Vector3,avatarLoading:!0,avatarMode:"standing",avatarSpeed:1,keyW:!1,keyA:!1,keyS:!1,keyD:!1,cursorPos:new u.Vector3,cursorNormal:new u.Vector3,cursorType:"hide",hoverData:!1,isDown:!1,camMode:"first",overlay:"",profile:!1,user:!1,reload:[],onlineUID:[]}),o=f.current=new D({collider:e.collider,startAt:a,Now:n});return c.onLoop((function(){var t,r,a=i(),l=a.camera,c=a.scene,s=e.scanCenter({camera:l,scene:c});(s&&(n.cursorPos.copy(s.point),n.cursorNormal.copy(s.face.normal)),n.hoverData!==(null===s||void 0===s||null===(t=s.object)||void 0===t?void 0:t.userData))&&(n.hoverData=(null===s||void 0===s||null===(r=s.object)||void 0===r?void 0:r.userData)||null);o.onSimulate()})),function(){c.clean()}}),[]),r.a.createElement("group",null,r.a.createElement("primitive",{object:t}),v.current&&"function"===typeof n&&n({Now:v.current}))};function P(){return(P=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(this,arguments)}var E=function(){function e(e){var n=e.node,t=e.numberOfScans,o=void 0===t?10:t,r=e.trailSize,a=void 0===r?32:r;this.node=n,this.WIDTH=a,this.HEIGHT=o,this.COUNT=this.WIDTH*this.HEIGHT,this.v3v000=new u.Vector3(0,0,0),this.wait=this.setup({node:n})}var n=e.prototype;return n.setup=function(e){var n=e.node;try{var t=this;return Promise.resolve(n.ready.gl).then((function(e){(t.gpu=new m.a(t.WIDTH,t.HEIGHT,e)).setDataType(u.HalfFloatType);var n=t.gpu.createTexture(),o=t.gpu.createTexture();t.fillPositionTexture(n),t.fillLookupTexture(o),t.positionVariable=t.gpu.addVariable("texturePosition",t.positionShader(),n),t.gpu.setVariableDependencies(t.positionVariable,[t.positionVariable]),t.positionUniforms=t.positionVariable.material.uniforms,t.positionUniforms.lookup={value:o};for(var r=t.HEIGHT,a=0;a<r;a++)t.positionUniforms["mouse"+a]={value:new u.Vector3(0,0,0)};t.positionUniforms.time={value:0},n.wrapS=u.RepeatWrapping,n.wrapT=u.RepeatWrapping;var i=t.gpu.init();null!==i&&console.error(i)}))}catch(o){return Promise.reject(o)}},n.positionShader=function(){var e=this;return"\n      "+function(){for(var n="",t=e.HEIGHT,o=0;o<t;o++)n+="\n          uniform vec3 mouse"+o.toFixed(0)+";\n        ";return n}()+"\n\n      uniform sampler2D lookup;\n      uniform float time;\n\n\t\t\tvoid main()\t{\n        // const float width = resolution.x;\n        // const float height = resolution.y;\n        // float xID = floor(gl_FragCoord.x);\n        // float yID = floor(gl_FragCoord.y);\n\n        vec2 uvCursor = vec2(gl_FragCoord.x, gl_FragCoord.y) / resolution.xy;\n        // vec4 positionHead = texture2D( texturePosition, uvCursor );\n\n        vec4 lookupData = texture2D(lookup, uvCursor);\n        vec2 nextUV = lookupData.xy;\n        float currentIDX = floor(gl_FragCoord.x);\n        float currentLine = floor(gl_FragCoord.y);\n\n        if (floor(currentIDX) == 0.0) {\n          "+function(){for(var n="if (false) {}",t=e.HEIGHT,o=0;o<t;o++)n+="\n          else if (currentLine == "+o.toFixed(0)+".0) {\n            gl_FragColor = vec4(mouse"+o.toFixed(0)+", 1.0);\n          }\n        ";return n}()+"\n        } else {\n          vec3 positionChain = texture2D( texturePosition,nextUV ).xyz;\n          gl_FragColor = vec4(positionChain, 1.0);\n        }\n\n\n\t\t\t}\n    "},n.fillPositionTexture=function(e){for(var n=0,t=e.image.data,o=0;o<this.HEIGHT;o++)for(var r=0;r<this.WIDTH;r++)t[n++]=0,t[n++]=0,t[n++]=0,t[n++]=0;e.needsUpdate=!0},n.fillLookupTexture=function(e){for(var n=0,t=e.image.data,o=[],r=0;r<this.HEIGHT;r++)for(var a=0;a<this.WIDTH;a++){var i=o[o.length-1]||[0,0];t[n++]=i[0],t[n++]=i[1],t[n++]=this.WIDTH,t[n++]=this.HEIGHT,o.push([a/this.WIDTH,r/this.HEIGHT])}e.needsUpdate=!0},n.render=function(e){var n=this,t=e.trackers;this.positionUniforms.time.value=window.performance.now()/1e3,t.forEach((function(e,t){var o=n.positionUniforms["mouse"+t];o&&o.value&&o.value.copy(e)})),this.gpu.compute()},n.getTextureAfterCompute=function(){return{posTexture:this.gpu.getCurrentRenderTarget(this.positionVariable).texture}},e}(),S=function(){function e(e){var n=e.node,t=e.sim,o=e.mounter;this.mounter=o,this.node=n,this.sim=t,this.wait=this.setup({node:n})}return e.prototype.setup=function(e){var n=e.node;try{var t=this,o=t.mounter,r=new k({count:t.sim.HEIGHT,numSides:4,subdivisions:2*t.sim.WIDTH,openEnded:!1}),a=r.geometry,i=r.subdivisions,l=r.count;a.instanceCount=l;var c=function(e){var n=e.controlPointsResolution,o=void 0===n?20:n,r=e.lineIdx,a=void 0===r?0:r,i=e.lineCount,l=void 0===i?t.sim.HEIGHT:i,c=e.textureName,s=void 0===c?"CONTROL_POINTS":c;o=Math.floor(o);var u=""+Number(o).toFixed(1);return"\n      vec3 pointIDX_"+s+"_"+a.toFixed(0)+" (float index) {\n        vec3 result = vec3(0.0);\n\n        vec4 color = texture2D("+s+",\n          vec2(\n            index / "+o.toFixed(1)+",\n            "+a.toFixed(1)+" / "+l.toFixed(1)+"\n          )\n        );\n\n        result = color.rgb;\n\n        return result;\n      }\n\n      vec3 catmullRom_"+s+"_"+a+" (vec3 p0, vec3 p1, vec3 p2, vec3 p3, float t) {\n          vec3 v0 = (p2 - p0) * 0.5;\n          vec3 v1 = (p3 - p1) * 0.5;\n          float t2 = t * t;\n          float t3 = t * t * t;\n\n          return vec3((2.0 * p1 - 2.0 * p2 + v0 + v1) * t3 + (-3.0 * p1 + 3.0 * p2 - 2.0 * v0 - v1) * t2 + v0 * t + p1);\n      }\n\n      vec3 getPointAt_"+a.toFixed(0)+" (float t) {\n        bool closed = false;\n        float ll = "+u+";\n        float minusOne = 1.0;\n        if (closed) {\n          minusOne = 0.0;\n        }\n\n        float p = (ll - minusOne) * t;\n        float intPoint = floor(p);\n        float weight = p - intPoint;\n\n        float idx0 = intPoint + -1.0;\n        float idx1 = intPoint +  0.0;\n        float idx2 = intPoint +  1.0;\n        float idx3 = intPoint +  2.0;\n\n        vec3 pt0 = pointIDX_"+s+"_"+a.toFixed(0)+"(idx0);\n        vec3 pt1 = pointIDX_"+s+"_"+a.toFixed(0)+"(idx1);\n        vec3 pt2 = pointIDX_"+s+"_"+a.toFixed(0)+"(idx2);\n        vec3 pt3 = pointIDX_"+s+"_"+a.toFixed(0)+"(idx3);\n\n        vec3 pointoutput = catmullRom_"+s+"_"+a+"(pt0, pt1, pt2, pt3, weight);\n\n        return pointoutput;\n      }\n      "},s=new u.ShaderMaterial({uniforms:{time:{value:0},matcap:{value:null},posTexture:{value:null}},vertexShader:"\n        // #include <common>\n        #define lengthSegments "+i.toFixed(1)+"\n\n        attribute float angle;\n        attribute float newPosition;\n        attribute float tubeInfo;\n\n        // varying vec2 vUv;\n        varying vec3 vNormal;\n        attribute vec4 offset;\n\n        uniform sampler2D posTexture;\n        // uniform sampler2D handTexture;\n\n        uniform float time;\n\n        mat4 rotationX( in float angle ) {\n          return mat4(\t1.0,\t\t0,\t\t\t0,\t\t\t0,\n                  0, \tcos(angle),\t-sin(angle),\t\t0,\n                  0, \tsin(angle),\t cos(angle),\t\t0,\n                  0, \t\t\t0,\t\t\t  0, \t\t1);\n        }\n\n        mat4 rotationY( in float angle ) {\n          return mat4(\tcos(angle),\t\t0,\t\tsin(angle),\t0,\n                      0,\t\t1.0,\t\t\t 0,\t0,\n                  -sin(angle),\t0,\t\tcos(angle),\t0,\n                      0, \t\t0,\t\t\t\t0,\t1);\n        }\n\n        mat4 rotationZ( in float angle ) {\n          return mat4(\tcos(angle),\t\t-sin(angle),\t0,\t0,\n                  sin(angle),\t\tcos(angle),\t\t0,\t0,\n                      0,\t\t\t\t0,\t\t1,\t0,\n                      0,\t\t\t\t0,\t\t0,\t1);\n        }\n\n        mat4 rotationMatrix (vec3 axis, float angle) {\n            axis = normalize(axis);\n            float s = sin(angle);\n            float c = cos(angle);\n            float oc = 1.0 - c;\n\n            return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,\n                        oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,\n                        oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,\n                        0.0,                                0.0,                                0.0,                                1.0);\n        }\n\n        "+function(){for(var e="",n=0;n<t.sim.HEIGHT;n++)e+=c({lineIdx:n,lineCount:t.sim.HEIGHT,controlPointsResolution:i,textureName:"posTexture"})+"\n";return e}()+"\n\n        vec3 sampleFnc (float t) {\n          vec3 pt = (offset.xyz + 0.5) * 0.0;\n\n          // pt = vec4(vec4(pt, 1.0) * rotationY(t * 0.1 + time * 0.1)).xyz;\n          // if (lineIDXER == 0.0) {\n          //   pt += getPointAt_0(t);\n          // }\n\n          float lineIDXER = offset.w;\n          // pt += getPointAt_0(t);\n\n          "+function(){for(var e="\n          if (false) {}",n=0;n<t.sim.HEIGHT;n++)e+="\n          else if (lineIDXER == "+n.toFixed(1)+") {\n            pt += getPointAt_"+n.toFixed(0)+"(t);\n          }\n        ";return e}()+"\n\n          // pt = getPointAt_2(t);\n\n          return pt;\n        }\n\n        void createTube (float t, vec2 volume, out vec3 pos, out vec3 normal) {\n          // find next sample along curve\n          float nextT = t + (1.0 / lengthSegments);\n\n          // sample the curve in two places\n          vec3 cur = sampleFnc(t);\n          vec3 next = sampleFnc(nextT);\n\n          // compute the Frenet-Serret frame\n          vec3 T = normalize(next - cur);\n          vec3 B = normalize(cross(T, next + cur));\n          vec3 N = -normalize(cross(B, T));\n\n          // extrude outward to create a tube\n          float tubeAngle = angle;\n          float circX = cos(tubeAngle);\n          float circY = sin(tubeAngle);\n\n          // compute position and normal\n          normal.xyz = normalize(B * circX + N * circY);\n          pos.xyz = cur + B * volume.x * circX + N * volume.y * circY;\n        }\n\n        varying float vT;\n        varying vec3 vViewPosition;\n\n        void main (void) {\n          vec3 transformed;\n          vec3 objectNormal;\n\n          float t = tubeInfo + 0.5;\n\n          vT = t;\n\n          vec2 volume = vec2(0.0333, 0.0333);\n          createTube(t, volume, transformed, objectNormal);\n\n          vec3 transformedNormal = normalMatrix * objectNormal;\n          vNormal = normalize(transformedNormal);\n\n          // vUv = uv.yx;\n\n          vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.0);\n          gl_Position = projectionMatrix * mvPosition;\n          vViewPosition = -mvPosition.xyz;\n        }\n      ",fragmentShader:"\n        varying float vT;\n        // varying vec2 vUv;\n        varying vec3 vNormal;\n        varying vec3 vViewPosition;\n        uniform sampler2D matcap;\n        void main (void) {\n\n          vec3 viewDir = normalize( vViewPosition );\n          vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n          vec3 y = cross( viewDir, x );\n          vec2 uv = vec2( dot( x, vNormal ), dot( y, vNormal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\n          vec4 matcapColor = texture2D( matcap, uv );\n\n          gl_FragColor = vec4(vec3(1.0, 1.0, 1.0), (1.0 - vT));\n        }\n      ",transparent:!0,blending:u.AdditiveBlending,depthTest:!1}),v=new u.Mesh(a,s);return v.frustumCulled=!1,v.userData.enableBloom=!0,o.add(v),n.onClean((function(){o.remove(v)})),t.sim.wait.then((function(){n.onLoop((function(){var e=t.sim.getTextureAfterCompute();s.uniforms.posTexture.value=e.posTexture,s.uniforms.time.value=window.performance.now()/1e3}))})),Promise.resolve()}catch(f){return Promise.reject(f)}},e}(),k=function(e){var n=e.count,t=void 0===n?20:n,o=e.numSides,r=void 0===o?4:o,a=e.subdivisions,i=void 0===a?50:a,l=e.openEnded,c=void 0===l||l,s=new u.CylinderBufferGeometry(1,1,1,r,i,c),v=new d.a;(v=v.fromBufferGeometry(s)).rotateZ(Math.PI/2);var f=new u.Vector2,m=[],p=[],g=[],x=v.vertices,y=v.faceVertexUvs[0],h=[];v.faces.forEach((function(e,n){var t=e.a,o=e.b,r=e.c,a=[x[t],x[o],x[r]],i=y[n];a.forEach((function(e,n){f.set(e.y,e.z).normalize();var t=Math.atan2(f.y,f.x);p.push(t),m.push(e.x),h.push(e.x,e.y,e.z),g.push(i[n].toArray())}))}));for(var w=new Float32Array(m),b=new Float32Array(p),z=new Float32Array(2*g.length),D=new Float32Array(h),T=0;T<w.length;T++){var E=g[T],S=E[0],k=E[1];z[2*T+0]=S,z[2*T+1]=k}var M=new u.InstancedBufferGeometry;M.instanceCount=t,M.setAttribute("position",new u.BufferAttribute(D,3)),M.setAttribute("tubeInfo",new u.BufferAttribute(w,1)),M.setAttribute("angle",new u.BufferAttribute(b,1)),M.setAttribute("uv",new u.BufferAttribute(z,2));for(var C=[],A=Math.floor(Math.pow(t,1/3)),I=0,R=0;R<A;R++)for(var j=0;j<A;j++)for(var F=0;F<A;F++)C.push(0,0,0,I),I++;return M.setAttribute("offset",new u.InstancedBufferAttribute(new Float32Array(C),4)),P({},e,{dataLength:w.length,geometry:M})},M=function(e){var n=e.mini,t=e.mounter,o=e.cursor,r=n,a=new E({node:r,mounter:t,numberOfScans:8,trailSize:64}),i=new S({node:r,sim:a,mounter:t});this.display=i;for(var l=[],c=function(e){!function(e){var t=e.update,a=e.setup,i=new u.Object3D;o.add(i),n.onClean((function(){o.remove(i)}));var c=new u.Object3D;i.add(c);var s=new u.Object3D;c.add(s);var v=new u.Vector3,f=new u.Vector3;a({origin:c,orbit:s}),r.onLoop((function(){var e;t({origin:c,orbit:s}),null!==(e=n.now)&&void 0!==e&&e.camera&&i.lookAt(n.now.camera.position),s.getWorldPosition(v),f.lerp(v,.3)})),l.push(f)}({setup:function(n){n.origin.rotation.z+=2*Math.PI/7*e},update:function(e){var n=e.origin,t=e.orbit;n.rotation.z+=.1,t.position.y=2*Math.sin(window.performance.now()/1e3)}})},s=0;s<7;s++)c(s);a.wait.then((function(){r.onLoop((function(){a.render({trackers:l})}))}))};function C(e){var n=e.Now,a=e.avatarSpeed,i=void 0===a?2:a,s=e.higherCamera,v=void 0===s?1.5:s,d=Object(l.d)(),m=d.get,p=d.gl,g=Object(o.useRef)({});return w("touchstart",(function(e){e.preventDefault()}),{passive:!1}),w("touchmove",(function(e){e.preventDefault()}),{passive:!1}),w("touchend",(function(e){e.preventDefault()}),{passive:!1}),Object(o.useEffect)((function(){var e=n.camMode;return n.camMode="first",n.avatarSpeed=i,function(){n.avatarSpeed=1,n.camMode=e}})),w("keydown",(function(e){"w"===e.key&&(n.keyW=!0),"a"===e.key&&(n.keyA=!0),"s"===e.key&&(n.keyS=!0),"d"===e.key&&(n.keyD=!0)})),w("keyup",(function(e){"w"===e.key&&(n.keyW=!1),"a"===e.key&&(n.keyA=!1),"s"===e.key&&(n.keyS=!1),"d"===e.key&&(n.keyD=!1)})),Object(o.useEffect)((function(){var e=m().camera;e.near=.1,e.far=1e4,e.fov=45,e.updateProjectionMatrix();var o=new u.Camera;o.position.z=5;var r=new f.a(o,p.domElement);r.enableRotate=!0,r.enablePan=!1,r.enableZoom=!1,r.enableDamping=!0,r.rotateSpeed=.5;var a=document.createElement("div");document.body.appendChild(a),a.style.cssText="\n      position: absolute;\n      bottom: 30px;\n      left: 30px;\n      width: 80px;\n      height: 80px;\n      color: white;\n      user-select: none;\n      z-index: 20;\n    ";var i=document.createElement("div");document.body.appendChild(i),i.style.cssText="\n      position: absolute;\n      bottom: 50px;\n      left: 50px;\n      width: 80px;\n      height: 80px;\n      color: white;\n      user-select: none;\n      z-index: 10;\n      text-align: center;\n      opacity: 0.4;\n    ",i.innerHTML="Walk Around JoyStick";var l=t(53).create({zone:a,color:"white",mode:"static",position:{left:"60px",bottom:"60px"}}),c=new u.Vector3(0,0,0),s=new u.Vector3(0,1,0),d=0,x=!1,y=0;l.on("start move dir plain",(function(e,n){var t,o;null!==n&&void 0!==n&&null!==(t=n.angle)&&void 0!==t&&t.radian&&(y=null===n||void 0===n||null===(o=n.angle)||void 0===o?void 0:o.radian,r.enableRotate=!1,x=!0,clearTimeout(d),d=setTimeout((function(){x=!1}),100))})),l.on("end",(function(){y=0,g.current.endForward=function(){c.multiplyScalar(.8)},r.enableRotate=!0,x=!1}));var h=b(p.domElement.parentElement,"touchend",(function(e){x||(r.enableRotate=!0)}),{passive:!1}),w=b(p.domElement.parentElement,"touchstart",(function(e){x||(r.enableRotate=!0)}),{passive:!1}),z=new u.Vector3(0,0,1),D=.3;return g.current.ctrl2=function(){x&&(c.set(0,0,-1),c.applyAxisAngle(s,r.getAzimuthalAngle()+y-.5*Math.PI||0)),D=n.keyW||n.keyA||n.keyS||n.keyD?u.MathUtils.lerp(D,.3,.1):u.MathUtils.lerp(D,0,.1),n.keyW?(z.set(0,0,-1*D),z.applyEuler(e.rotation),z.y=0,n.avatarAt.add(z).multiplyScalar(1)):n.keyA?(z.set(-1*D,0,0),z.applyEuler(e.rotation),z.y=0,n.avatarAt.add(z).multiplyScalar(1)):n.keyS?(z.set(0,0,1*D),z.applyEuler(e.rotation),z.y=0,n.avatarAt.add(z).multiplyScalar(1)):n.keyD&&(z.set(1*D,0,0),z.applyEuler(e.rotation),z.y=0,n.avatarAt.add(z).multiplyScalar(1)),n.goingTo.copy(n.avatarAt)},g.current.ctrl3=function(){"floor"!==n.cursorType&&(n.cursorType="floor")},g.current.ctrl=function(){r.update(),n.goingTo.add(c),e.position.x=n.avatarAt.x,e.position.y=n.avatarAt.y+v,e.position.z=n.avatarAt.z,e.rotation.copy(o.rotation)},n.enableFloorCursor=!1,function(){n.enableFloorCursor=!0,l.off("start move end dir plain"),l.destroy(),document.body.removeChild(a),a.remove(),i.remove(),h(),w()}}),[]),Object(l.b)((function(){Object.values(g.current).forEach((function(e){return e()}))})),r.a.createElement("group",null,r.a.createElement(c.a,{fov:45,near:.1,far:1e4,position:[0,20,20],"rotation-x":-.25*Math.PI,makeDefault:!0}))}function A(e){var n=e.Now,t=h().mini,a=Object(o.useRef)();return Object(o.useEffect)((function(){var e=a.current;console.log(123),e&&t.ready.scene.then((function(n){return new M({mini:t,cursor:e,mounter:n})}))}),[]),Object(l.b)((function(e,t){if(a.current){var o=a.current;o.position.lerp(n.cursorPos,.4),o.lookAt(e.camera.position)}})),r.a.createElement("group",{ref:a})}var I=function(e){var n=e.mini,o=n.now.get,r=new u.Vector2;r.copy({x:o().gl.domElement.width,y:o().gl.domElement.height}),r.multiplyScalar(.35);var a=t(56).EffectComposer,i=t(54).RenderPass,l=t(57).UnrealBloomPass,c=new a(o().gl);n.onResize((function(){c.setPixelRatio(o().gl.getPixelRatio())}));var s=new i(o().scene,o().camera);n.onResize((function(){r.copy({x:o().gl.domElement.width,y:o().gl.domElement.height}),r.multiplyScalar(.35),s.setSize(r.x,r.y)})),c.addPass(s);var v=new l(r,2,1,.1);n.onResize((function(){r.copy({x:o().gl.domElement.width,y:o().gl.domElement.height}),r.multiplyScalar(.35),v.setSize(r.x,r.y)})),c.addPass(v),c.renderToScreen=!1;var f=new u.Color("#000000"),d=new u.MeshBasicMaterial({color:0,skinning:!0}),m=new u.Layers;m.disableAll(),m.enable(0);var p=new u.Layers;p.disableAll(),p.enable(1);var g=new u.Layers;g.disableAll(),g.enable(2);var x=function(e){e.text||(e.material=d,d.needsUpdate=!0)};this.renderTexture=function(){var e=o().gl;e.shadowMap.enabled=!1,o().scene.traverse((function(e){var n,t,o;e.material&&(e.userData.originalMaterial=e.material,e.userData.originalRoughness=e.material.roughness,e.userData.originalMetalness=e.material.metalness,e.userData.originalColor=e.material.color||new u.Color("#ffffff"),null!==(n=e.material)&&void 0!==n&&null!==(t=n.uniforms)&&void 0!==t&&null!==(o=t.color)&&void 0!==o&&o.value&&(e.userData.originalUniformColor=e.material.uniforms.color.value))})),o().scene.traverse((function(e){var n;if(e.isLight&&(e.visible=!1),null!==e&&void 0!==e&&null!==(n=e.userData)&&void 0!==n&&n.discard&&(e.visible=!1),e.material){var t,o;if(null!==e&&void 0!==e&&null!==(t=e.userData)&&void 0!==t&&t.enableDarken)return void x(e);null!==e&&void 0!==e&&null!==(o=e.userData)&&void 0!==o&&o.enableBloom?e.material=e.userData.originalMaterial:g.test(e.layers)||!p.test(e.layers)?x(e):e.material=e.userData.originalMaterial}})),function(){var e=o(),n=e.scene,t=e.clock.getDelta(),r=n.background;n.background=f,c.render(t),n.background=r}(),o().scene.traverse((function(e){var n,t,o,r,a,i,l;!e.text&&e.material&&e.userData.originalMaterial&&(e.material=e.userData.originalMaterial,null!==e&&void 0!==e&&null!==(t=e.material)&&void 0!==t&&t.color&&null!==e&&void 0!==e&&null!==(o=e.userData)&&void 0!==o&&o.originalColor&&(e.material.color=e.userData.originalColor),null!==e&&void 0!==e&&null!==(r=e.userData)&&void 0!==r&&r.originalRoughness&&(e.material.roughness=e.userData.originalRoughness,e.material.metalness=e.userData.originalMetalness),null!==(a=e.material)&&void 0!==a&&null!==(i=a.uniforms)&&void 0!==i&&null!==(l=i.color)&&void 0!==l&&l.value&&(e.material.uniforms.color.value=e.userData.originalUniformColor)),e.isLight&&(e.visible=!0),null!==e&&void 0!==e&&null!==(n=e.userData)&&void 0!==n&&n.discard&&(e.visible=!0)})),e.shadowMap.enabled=!0},this.getTex=function(){return c.readBuffer.texture}},R=function(e){var n=this,t=e.mini,o=t.now,r=o.size,a=o.gl,i=o.get,l=new u.Vector2;l.copy({x:r.width,y:r.height}),l.multiplyScalar(a.getPixelRatio()),this.rtt=new u.WebGLRenderTarget(l.width,l.height,{encoding:u.sRGBEncoding,generateMipmaps:!1}),t.onClean((function(){n.rtt.dispose()})),t.onResize((function(){l.copy({x:i().gl.domElement.width,y:i().gl.domElement.height}),l.multiplyScalar(a.getPixelRatio()),n.rtt=new u.WebGLRenderTarget(l.width,l.height,{encoding:u.sRGBEncoding,generateMipmaps:!1})})),this.renderTexture=function(){var e=i(),t=e.gl,o=e.camera,r=e.scene,a=t.getRenderTarget();t.setRenderTarget(n.rtt),t.render(r,o),t.setRenderTarget(a)},this.getTex=function(){return n.rtt.texture}},j=function(e){var n=e.mini,t=new u.ShaderMaterial({uniforms:{bloomDiffuse:{value:null},baseDiffuse:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main (void) {\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n          vUv = uv;\n        }\n      ",fragmentShader:"\n        uniform sampler2D baseDiffuse;\n        uniform sampler2D bloomDiffuse;\n\n        varying vec2 vUv;\n          void main (void) {\n            vec4 baseDiffuseColor = texture2D(baseDiffuse, vUv);\n            vec4 bloomDiffuseColor = texture2D(bloomDiffuse, vUv);\n\n            gl_FragColor = vec4(baseDiffuseColor.rgb * 1.0,  baseDiffuseColor.a);\n\n            gl_FragColor.r += 0.45 * pow(bloomDiffuseColor.r, 0.75);\n            gl_FragColor.g += 0.45 * pow(bloomDiffuseColor.g, 0.75);\n            gl_FragColor.b += 0.45 * pow(bloomDiffuseColor.b, 0.75);\n          }\n        "}),o=new g.a(t);this.render=function(e){var r=e.baseTex,a=e.bloomTex,i=n.now.gl;i&&(t.uniforms.bloomDiffuse.value=a,t.uniforms.baseDiffuse.value=r,o.render(i))}};function F(){var e=h().mini,n=Object(o.useRef)((function(){}));return Object(o.useEffect)((function(){e.ready.get.then((function(){var t=new R({mini:e}),o=new I({mini:e}),r=new j({mini:e});n.current=function(){t.renderTexture(),o.renderTexture(),r.render({baseTex:t.getTex(),bloomTex:o.getTex()})}}))}),[]),Object(l.b)((function(){n.current()}),1e3),null}function O(){var e={vertexShader:"\n    varying vec3 vPos;\n    varying vec3 vUv3;\n\n    void main() {\n      vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n      gl_Position = projectionMatrix * mvPosition;\n      vPos = position;\n      vUv3 = uv.xyx;\n    }\n    ",fragmentShader:"\n      precision highp float;\n\n      vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}\n      vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}\n      vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}\n\n      float cnoise(vec3 P){\n        vec3 Pi0 = floor(P); // Integer part for indexing\n        vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n        Pi0 = mod(Pi0, 289.0);\n        Pi1 = mod(Pi1, 289.0);\n        vec3 Pf0 = fract(P); // Fractional part for interpolation\n        vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n        vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n        vec4 iy = vec4(Pi0.yy, Pi1.yy);\n        vec4 iz0 = Pi0.zzzz;\n        vec4 iz1 = Pi1.zzzz;\n\n        vec4 ixy = permute(permute(ix) + iy);\n        vec4 ixy0 = permute(ixy + iz0);\n        vec4 ixy1 = permute(ixy + iz1);\n\n        vec4 gx0 = ixy0 / 7.0;\n        vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n        gx0 = fract(gx0);\n        vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n        vec4 sz0 = step(gz0, vec4(0.0));\n        gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n        gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n        vec4 gx1 = ixy1 / 7.0;\n        vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n        gx1 = fract(gx1);\n        vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n        vec4 sz1 = step(gz1, vec4(0.0));\n        gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n        gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n        vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n        vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n        vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n        vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n        vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n        vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n        vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n        vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n        vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n        g000 *= norm0.x;\n        g010 *= norm0.y;\n        g100 *= norm0.z;\n        g110 *= norm0.w;\n        vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n        g001 *= norm1.x;\n        g011 *= norm1.y;\n        g101 *= norm1.z;\n        g111 *= norm1.w;\n\n        float n000 = dot(g000, Pf0);\n        float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n        float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n        float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n        float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n        float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n        float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n        float n111 = dot(g111, Pf1);\n\n        vec3 fade_xyz = fade(Pf0);\n        vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n        vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n        float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n        return 2.2 * n_xyz;\n      }\n\n      varying vec3 vPos;\n      uniform float time;\n      varying vec3 vUv3;\n\n      void main() {\n        float speed = time / 3.5;\n        vec3 pp = vUv3 * 600.0;\n        // pp = vPos * 0.25 + speed;\n        float noise = clamp(cnoise(speed + pp / 250.0 + 0.0 ), 0.0, 1.0);\n\n        vec3 colorA = vec3(81.0, 135.0, 228.0) * 0.2 / 255.0;\n        vec3 colorB = vec3(0.0, 150.0, 136.0) * 0.2 / 255.0;\n\n        vec4 backgroundColor = vec4(mix(colorA, colorB, noise), 1.0);\n\n        gl_FragColor = backgroundColor;\n\n        float starNoise = (noise) * pow(cnoise(speed + pp * 2.0) * 0.5 + 0.5, 15.5) * 30.0;\n\n        gl_FragColor.rgb += vec3(pow(starNoise, 1.3)) * 1.5;\n      }\n      "},n=Object(o.useRef)();Object(o.useEffect)((function(){n.current&&(n.current.needsUpdate=!0)}),[e,e.fragmentShader,e.vertexShader]);var t=Object(o.useRef)({time:{value:0}});return Object(l.b)((function(){t.current.time.value+=1/60})),r.a.createElement(p.a,{frustumCulled:!1,userData:{enableBloom:!0},scale:1,args:[800,20,20]},r.a.createElement("shaderMaterial",{ref:n,uniforms:t.current,fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,side:u.DoubleSide}))}function _(e){var n=e.imageURL,t=Object(l.d)(),r=t.scene,a=t.gl;return Object(o.useEffect)((function(){var e=new u.PMREMGenerator(a);return e.compileEquirectangularShader(),(new u.TextureLoader).load(n,(function(n){var t=e.fromEquirectangular(n).texture;t.encoding=u.sRGBEncoding,r.environment=t})),function(){r.environment=null,r.background=null}}),[n]),null}var V=t(32);function H(){var e=Object(s.a)("/map/demo-map-000.glb"),n=Object(o.useMemo)((function(){var n=V.SkeletonUtils.clone(e.scene);return n.traverse((function(e){e&&(e.material&&(e.material=e.material.clone()),e.geometry&&(e.userData.isFloor=!0))})),n}),[e]);return r.a.createElement("group",null,n&&r.a.createElement(T,{floor:n,startAt:{x:0,y:0,z:0}},(function(e){var n=e.Now;return r.a.createElement("group",null,r.a.createElement(C,{higherCamera:1.5,avatarSpeed:2,Now:n}),r.a.createElement(A,{Now:n}))})),r.a.createElement("primitive",{object:n}),r.a.createElement(F,null),r.a.createElement("directionalLight",{position:[10,10,10]}),r.a.createElement(_,{imageURL:"/image/sky.png"}),r.a.createElement(O,null))}var N=function(){return r.a.createElement(l.a,{style:{width:"100%",height:"100%"}},r.a.createElement(o.Suspense,{fallback:r.a.createElement("group",null,r.a.createElement("group",{"rotation-x":0*Math.PI},r.a.createElement("gridHelper",{args:[150,50,2302755,11184810]})),r.a.createElement(c.a,{position:[0,20,20],"rotation-x":-.25*Math.PI,makeDefault:!0}))},r.a.createElement(H,null)))};i.a.render(r.a.createElement(N,null),document.getElementById("root"))}},[[41,1,2]]]);
//# sourceMappingURL=main.e364578a.chunk.js.map