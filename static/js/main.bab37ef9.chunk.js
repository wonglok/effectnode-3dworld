(this["webpackJsonpeffectnode-3dworld-example"]=this["webpackJsonpeffectnode-3dworld-example"]||[]).push([[0],{42:function(e,t,n){e.exports=n(57)},43:function(e,t,n){},57:function(e,t,n){"use strict";n.r(t);n(43);var o=n(5),r=n.n(o),a=n(35),i=n.n(a),c=n(10),l=n(67),s=n(64),u=n(62),v=n(0),f=n(65),m=n(33),d=n(36),p=n(63),g=n(66),y=n(37),x=n(38),h=n(15),w=function(e){void 0===e&&(e={});var t="_"+Math.random().toString(36).substr(2,9)+Math.random().toString(36).substr(2,9),n={exportJSON:function(){return JSON.parse(JSON.stringify(e))},getNameSpcaeID:function(){return t},onEvent:function(n,o){var r=""+t,a=function(){o(e[n])};return window.addEventListener(r+"-"+n,a),function(){window.removeEventListener(r+"-"+n,a)}},makeKeyReactive:function(e){var n=Object(o.useState)(0),r=n[0],a=n[1];Object(o.useEffect)((function(){var n=""+t,o=function(){a((function(e){return e+1}))};return window.addEventListener(n+"-"+e,o),function(){window.removeEventListener(n+"-"+e,o)}}),[r])},reloadKey:function(e){window.dispatchEvent(new CustomEvent(t+"-"+e,{detail:{}}))}};return new Proxy(e,{get:function(e,t){return n[t]?n[t]:e[t]},set:function(e,n,o){return e[n]!==o&&(e[n]=o,"undefined"!==typeof window&&window.dispatchEvent(new CustomEvent(t+"-"+n,{detail:{}}))),!0}})},b=function(e){var t=this,n=e.parent,o=void 0!==n&&n;this.parent=o,this.resource=new Map,this.get=function(e){return new Promise((function(n){var o=0;o=setInterval((function(){t.parent?(t.resource.has(e)||t.parent.resource.has(e))&&(clearInterval(o),n(t.resource.get(e)||t.parent.resource.get(e))):t.resource.has(e)&&(clearInterval(o),n(t.resource.get(e)))}))}))},this.set=function(e,n){t.resource.set(e,n)},this.name="ENMini";var r=!1;this.tasks=[],this.resizeTasks=[],this.cleanTasks=[],this.onLoop=function(e,n){void 0===n&&(n=0),n>=0?t.tasks.push(e):t.tasks.unshift(e)},this.onResize=function(e){e(),t.resizeTasks.push(e)},this.onClean=function(e){t.cleanTasks.push(e)};var a=0;window.addEventListener("resize",(function(){clearTimeout(a),a=setTimeout((function(){t.resizeTasks.forEach((function(e){return e()}))}),16.8888)}));var i=!1;this.toggle=function(){i=!i},this.pause=function(){i=!0},this.play=function(){i=!1},this.clean=function(){r=!0;try{t.cleanTasks.forEach((function(e){return e()}))}catch(e){console.error(e)}},this.lastTime=window.performance.now(),this.work=function(){if(t.timeNow=window.performance.now(),r)return{name:t.name,duration:0};if(i)return{name:t.name,duration:0};var e=window.performance.now();try{var n=t.timeNow,o=t.lastTime,a=n-o;t.lastTime=n,n/=1e3,(a/=1e3)>=100&&(a=100),t.tasks.forEach((function(e){return e(n,a)}))}catch(l){console.error(l)}var c=window.performance.now()-e;return{name:t.name,duration:c}},this.ready=new Proxy({},{get:function(e,n){return t.get(n)}}),this.now=new Proxy({},{get:function(e,n){return t.parent?t.resource.get(n)||t.parent.resource.get(n):t.resource.get(n)}})};function E(){var e=Object(c.e)().get,t=Object(o.useState)((function(){return new b({})}))[0];return Object(o.useEffect)((function(){return function(){t.clean()}}),[]),Object(c.c)((function(){var n=e();for(var o in n)t.set(o,n[o]);t.work()})),{mini:t}}var D=function(e,t,n,r){void 0===n&&(n={passive:!1}),Object(o.useEffect)((function(){return(r=r||window).addEventListener(e,t,n),function(){(r=r||window).removeEventListener(e,t)}}),[])},P=function(e,t,n,o){return void 0===o&&(o={passive:!1}),(e=e||window).addEventListener(t,n,o),function(){(e=e||window).removeEventListener(t,n)}},z=function(){function e(e){var t=e.floor,n=e.scene;this.floor=t,this.center=new v.Vector2(0,0),this.raycaster=new v.Raycaster,this.scene=n;var o=this.makeCollider();this.collider=o,this.preview=o}var t=e.prototype;return t.makeCollider=function(){var e=this.scene,t=this.floor,o=n(52).BufferGeometryUtils,r=n(33).SkeletonUtils.clone(t),a=[];r.updateMatrixWorld(),r.traverse((function(e){if(e.geometry&&!e.userData.isNotFloor){var t=e.geometry.clone();for(var n in t.applyMatrix4(e.matrixWorld),t.attributes)"position"===n||"index"===n||t.deleteAttribute(n);a.push(t)}})),e.traverse((function(e){if(e&&e.userData&&e.userData.isFloor&&e.geometry){var t=e.geometry.clone();for(var n in e.updateMatrixWorld(),t.applyMatrix4(e.matrixWorld),t.attributes)"position"!==n&&t.deleteAttribute(n);a.push(t)}}));var i=o.mergeBufferGeometries(a,!1);i.boundsTree=new f.a(i);var c=new v.Mesh(i,new v.MeshBasicMaterial({color:16777215}));return c.material.wireframe=!0,c.material.opacity=.5,c.material.transparent=!0,c.updateMatrixWorld(),c},t.scanCenter=function(e){var t=e.camera,n=e.scene,o=this.raycaster,r=this.center,a=this.collider;o.setFromCamera(r,t);var i=[],c=[];n.traverse((function(e){var t,n,o,r;e.geometry&&(null!==e&&void 0!==e&&null!==(t=e.userData)&&void 0!==t&&t.isHoverable||null!==e&&void 0!==e&&null!==(n=e.userData)&&void 0!==n&&n.isFloor||null!==e&&void 0!==e&&null!==(o=e.userData)&&void 0!==o&&o.tooltip||null!==e&&void 0!==e&&null!==(r=e.userData)&&void 0!==r&&r.website)&&c.push(e)})),o.intersectObjects(c,!1,i),a.geometry.boundsTree.raycastFirst(a,o,o.ray);var l=i[0];return l||!1},e}(),T=function(e){var t=e.collider,o=e.startAt,r=e.Now;this.collider=t;var a=n(53).RoundedBoxGeometry,i=new v.Mesh(new a(1,2,1,8,1.3),new v.MeshLambertMaterial({transparent:!0,opacity:1}));i.geometry.translate(0,-1.3,0),i.castShadow=!0,i.capsuleInfo={radius:1.3,segment:new v.Line3(new v.Vector3,new v.Vector3(0,-1,0))},this.player=i,i.position.copy(o),i.position.y+=5,i.geometry.computeBoundingBox(),i.collider=(new v.Box3).copy(i.geometry.boundingBox);var c=new v.Vector3,l=new v.Vector3(0,0,0),s=new v.Vector3,u=new v.Vector3,f=new v.Box3,m=new v.Matrix4,d=new v.Line3,p=new v.Object3D;function g(e){var n=e.delta,a=e.player;l.y+=-9.8*n,a.position.addScaledVector(l,n),a.position.y<=-50&&(a.position.copy(o),r.goingTo.copy(o),r.goingTo.z+=1,l.y=0),c.copy(r.goingTo).sub(a.position),c.y=0;var i=c.length();c.normalize(),c.y=0,c.multiplyScalar(r.avatarSpeed),i>=.1?(a.position.addScaledVector(c,.04),r.avatarMode="running"):r.avatarMode="standing",a.updateMatrixWorld();var v=a.capsuleInfo;f.makeEmpty(),m.copy(t.matrixWorld).invert(),d.copy(v.segment),d.start.applyMatrix4(a.matrixWorld).applyMatrix4(m),d.end.applyMatrix4(a.matrixWorld).applyMatrix4(m),f.expandByPoint(d.start),f.expandByPoint(d.end),f.min.addScalar(-v.radius),f.max.addScalar(v.radius),t.geometry.boundsTree.shapecast(t,{intersectsBounds:function(e){return e.intersectsBox(f)},intersectsTriangle:function(e){var t=s,n=u,o=e.closestPointToSegment(d,t,n);if(o<v.radius){var r=v.radius-o,a=n.sub(t).normalize();d.start.addScaledVector(a,r),d.end.addScaledVector(a,r)}}});var g=s;g.copy(d.start).applyMatrix4(t.matrixWorld);var y=u;y.subVectors(g,a.position),a.position.copy(g),r.avatarAt.copy(a.position),p.position.copy(a.position),p.lookAt(r.goingTo.x,a.position.y,r.goingTo.z),r.avatarRot.x=p.rotation.x,r.avatarRot.y=p.rotation.y,r.avatarRot.z=p.rotation.z,y.y>Math.abs(n*l.y*.25)?l.set(0,0,0):(y.normalize(),l.addScaledVector(y,-y.dot(l)))}var y=new v.Clock;this.onSimulate=function(){var e=y.getDelta();e>=1/30&&(e=1/30);for(var t=0;t<4;t++)g({delta:e/4,player:i})}};function M(){return(M=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}var S="\nconst mat2 m = mat2( 0.80,  0.60, -0.60,  0.80 );\n\nfloat noise( in vec2 p ) {\n  return sin(p.x)*sin(p.y);\n}\n\nfloat fbm4( vec2 p ) {\n    float f = 0.0;\n    f += 0.5000 * noise( p ); p = m * p * 2.02;\n    f += 0.2500 * noise( p ); p = m * p * 2.03;\n    f += 0.1250 * noise( p ); p = m * p * 2.01;\n    f += 0.0625 * noise( p );\n    return f / 0.9375;\n}\n\nfloat fbm6( vec2 p ) {\n    float f = 0.0;\n    f += 0.500000*(0.5 + 0.5 * noise( p )); p = m*p*2.02;\n    f += 0.250000*(0.5 + 0.5 * noise( p )); p = m*p*2.03;\n    f += 0.125000*(0.5 + 0.5 * noise( p )); p = m*p*2.01;\n    f += 0.062500*(0.5 + 0.5 * noise( p )); p = m*p*2.04;\n    f += 0.031250*(0.5 + 0.5 * noise( p )); p = m*p*2.01;\n    f += 0.015625*(0.5 + 0.5 * noise( p ));\n    return f/0.96875;\n}\n\nfloat pattern (vec2 p) {\n  float vout = fbm4( p + time + fbm6(  p + fbm4( p + time )) );\n  return abs(vout);\n}\n\nvec4 mainImage (vec2 uv) {\n  return vec4(vec3(\n    0.35 + pattern(uv * 1.70123 + -0.17 * cos(time * 0.05)),\n    0.35 + pattern(uv * 1.70123 +  0.0 * cos(time * 0.05)),\n    0.35 + pattern(uv * 1.70123 +  0.17 * cos(time * 0.05))\n  ), 1.0);\n}\n";var C=function(e){var t=e.children,n=e.object,a=Object(c.e)().get,i=Object(o.useRef)(),l=E().mini,s=Object(o.useRef)(),u=Object(o.useRef)(),f=Object(o.useState)(!1),d=f[0],p=f[1];Object(o.useEffect)((function(){var e=a().gl;return e.shadowMap.enabled=!0,e.shadowMap.type=v.PCFSoftShadowMap,function(){}}),[]);return Object(o.useEffect)((function(){var e=i.current=w({startLookAt:new v.Vector3,startAt:new v.Vector3,moved:0,goingTo:new v.Vector3,camAt:new v.Vector3,avatarAt:new v.Vector3,avatarHead:new v.Vector3,avatarRot:new v.Vector3,avatarFaceLook:new v.Vector3,avatarLoading:!0,avatarMode:"standing",avatarSpeed:1,tooltip:"",keyW:!1,keyA:!1,keyS:!1,keyD:!1,cursorPos:new v.Vector3,cursorNormal:new v.Vector3,cursorType:"hide",hoverData:!1,isDown:!1,camMode:"first",overlay:"",profile:!1,user:!1,reload:[],onlineUID:[]}),t=m.SkeletonUtils.clone(n);t.traverse((function(t){t&&(t.userData.startAt&&t.getWorldPosition(e.startAt),t.userData.startLookAt&&t.getWorldPosition(e.startLookAt),t.geometry&&(t.userData.isFloor=!0,t.material.writeDepth=!0))}));var o=function(e){var t=a().gl;return t.physicallyCorrectLights=!0,e.traverse((function(e){var t,n;null!==e&&void 0!==e&&null!==(t=e.userData)&&void 0!==t&&t.castShadow&&(e.castShadow=!0,e.traverse((function(e){e.castShadow=!0}))),null!==e&&void 0!==e&&null!==(n=e.userData)&&void 0!==n&&n.receiveShadow&&(e.receiveShadow=!0,e.traverse((function(e){e.receiveShadow=!0})))})),e.traverse((function(e){e instanceof v.PointLight&&e.castShadow&&(e.shadow.mapSize.width=512,e.shadow.mapSize.height=512,e.shadow.camera.near=.5,e.shadow.camera.far=500)})),function(){t.physicallyCorrectLights=!1}}(t);p(t);var r=s.current=new z({floor:t,scene:a().scene}),c=u.current=new T({collider:r.collider,startAt:e.startAt,Now:e}),f=function(e){void 0===e&&(e="#ffffff"),window.dispatchEvent(new window.CustomEvent("set-tail-color",{detail:e}))},d=!1;return l.onLoop((function(){var t,n=a(),o=n.camera,i=n.scene,l=r.scanCenter({camera:o,scene:i});(l&&(e.cursorPos.copy(l.point),e.cursorNormal.copy(l.face.normal)),l&&(l.object.userData.website||l.object.userData.tooltip)?f(l.object.userData.hoverColor||"#00ffff"):f("#ffffff"),l?(d&&(d.userData.enableBloom=!1),(l.object.userData.website||l.object.userData.tooltip)&&(l.object.userData.enableBloom=!0,d=l.object)):d&&(d.userData.enableBloom=!1),l)?(e.hoverData!==l.object.userData&&(e.hoverData=l.object.userData||null),e.tooltip!==(null===(t=l.object.userData)||void 0===t?void 0:t.tooltip)&&(e.tooltip=l.object.userData.tooltip)):(null!==e.hoverData&&(e.hoverData=null),""!==e.tooltip&&(e.tooltip=""));c.onSimulate()})),function(){o(),l.clean()}}),[]),r.a.createElement("group",null,d&&r.a.createElement("primitive",{object:d}),i.current&&"function"===typeof t&&t({Now:i.current}))};function k(e){var t=e.Now,a=e.avatarSpeed,i=void 0===a?2:a,l=e.higherCamera,s=void 0===l?1.5:l,f=Object(c.e)(),m=f.get,p=f.gl,g=Object(o.useRef)({});return Object(o.useEffect)((function(){t.avatarAt.copy(t.startAt),t.goingTo.copy(t.startAt)})),D("touchstart",(function(e){e.preventDefault()}),{passive:!1}),D("touchmove",(function(e){e.preventDefault()}),{passive:!1}),D("touchend",(function(e){e.preventDefault()}),{passive:!1}),Object(o.useEffect)((function(){var e=t.camMode;return t.camMode="first",t.avatarSpeed=i,function(){t.avatarSpeed=1,t.camMode=e}})),D("keydown",(function(e){"w"===e.key&&(t.keyW=!0),"a"===e.key&&(t.keyA=!0),"s"===e.key&&(t.keyS=!0),"d"===e.key&&(t.keyD=!0)})),D("keyup",(function(e){"w"===e.key&&(t.keyW=!1),"a"===e.key&&(t.keyA=!1),"s"===e.key&&(t.keyS=!1),"d"===e.key&&(t.keyD=!1)})),Object(o.useEffect)((function(){var e=m().camera;e.near=.1,e.far=1e4,e.fov=45,e.updateProjectionMatrix();var o=new v.Camera,r=new d.a(o,p.domElement);r.enableRotate=!0,r.enablePan=!1,r.enableZoom=!1,r.enableDamping=!0,r.rotateSpeed=.5,o.position.copy(t.startAt),r.target.copy(t.startLookAt);var a=document.createElement("div");document.body.appendChild(a),a.style.cssText="\n      position: absolute;\n      bottom: 30px;\n      left: 30px;\n      width: 80px;\n      height: 80px;\n      color: white;\n      user-select: none;\n      z-index: 20;\n    ";var i=document.createElement("div");document.body.appendChild(i),i.style.cssText="\n      position: absolute;\n      bottom: 50px;\n      left: 50px;\n      width: 80px;\n      height: 80px;\n      color: white;\n      user-select: none;\n      z-index: 10;\n      text-align: center;\n      opacity: 0.4;\n    ",i.innerHTML="Walk Around JoyStick";var c=n(54).create({zone:a,color:"white",mode:"static",position:{left:"60px",bottom:"60px"}}),l=new v.Vector3(0,0,0),u=new v.Vector3(0,1,0),f=0,y=!1,x=0;c.on("start move dir plain",(function(e,t){var n,o;null!==t&&void 0!==t&&null!==(n=t.angle)&&void 0!==n&&n.radian&&(x=null===t||void 0===t||null===(o=t.angle)||void 0===o?void 0:o.radian,r.enableRotate=!1,y=!0,clearTimeout(f),f=setTimeout((function(){y=!1}),100))})),c.on("end",(function(){x=0,g.current.endForward=function(){l.multiplyScalar(.8)},r.enableRotate=!0,y=!1}));var h=P(p.domElement.parentElement,"touchend",(function(e){y||(r.enableRotate=!0)}),{passive:!1}),w=P(p.domElement.parentElement,"touchstart",(function(e){y||(r.enableRotate=!0)}),{passive:!1}),b=new v.Vector3(0,0,1),E=.3;return g.current.ctrl2=function(){y&&(l.set(0,0,-1),l.applyAxisAngle(u,r.getAzimuthalAngle()+x-.5*Math.PI||0)),E=t.keyW||t.keyA||t.keyS||t.keyD?v.MathUtils.lerp(E,.3,.1):v.MathUtils.lerp(E,0,.1),t.keyW?(b.set(0,0,-1*E),b.applyEuler(e.rotation),b.y=0,t.avatarAt.add(b).multiplyScalar(1)):t.keyA?(b.set(-1*E,0,0),b.applyEuler(e.rotation),b.y=0,t.avatarAt.add(b).multiplyScalar(1)):t.keyS?(b.set(0,0,1*E),b.applyEuler(e.rotation),b.y=0,t.avatarAt.add(b).multiplyScalar(1)):t.keyD&&(b.set(1*E,0,0),b.applyEuler(e.rotation),b.y=0,t.avatarAt.add(b).multiplyScalar(1)),t.goingTo.copy(t.avatarAt)},g.current.ctrl3=function(){"floor"!==t.cursorType&&(t.cursorType="floor")},g.current.ctrl=function(){r.update(),t.goingTo.add(l),e.position.x=t.avatarAt.x,e.position.y=t.avatarAt.y+s,e.position.z=t.avatarAt.z,e.rotation.copy(o.rotation)},t.enableFloorCursor=!1,function(){t.enableFloorCursor=!0,c.off("start move end dir plain"),c.destroy(),document.body.removeChild(a),a.remove(),i.remove(),h(),w()}}),[]),Object(c.c)((function(){Object.values(g.current).forEach((function(e){return e()}))})),r.a.createElement("group",null,r.a.createElement(u.a,{fov:45,near:.1,far:1e4,position:[0,20,20],"rotation-x":-.25*Math.PI,makeDefault:!0}))}var j=function(){function e(e){var t=e.node,n=e.numberOfScans,o=void 0===n?10:n,r=e.trailSize,a=void 0===r?32:r;this.node=t,this.WIDTH=a,this.HEIGHT=o,this.COUNT=this.WIDTH*this.HEIGHT,this.v3v000=new v.Vector3(0,0,0),this.wait=this.setup({node:t})}var t=e.prototype;return t.setup=function(e){var t=e.node;try{var n=this;return Promise.resolve(t.ready.gl).then((function(e){(n.gpu=new x.a(n.WIDTH,n.HEIGHT,e)).setDataType(v.HalfFloatType);var t=n.gpu.createTexture(),o=n.gpu.createTexture();n.fillPositionTexture(t),n.fillLookupTexture(o),n.positionVariable=n.gpu.addVariable("texturePosition",n.positionShader(),t),n.gpu.setVariableDependencies(n.positionVariable,[n.positionVariable]),n.positionUniforms=n.positionVariable.material.uniforms,n.positionUniforms.lookup={value:o};for(var r=n.HEIGHT,a=0;a<r;a++)n.positionUniforms["mouse"+a]={value:new v.Vector3(0,0,0)};n.positionUniforms.time={value:0},t.wrapS=v.RepeatWrapping,t.wrapT=v.RepeatWrapping;var i=n.gpu.init();null!==i&&console.error(i)}))}catch(o){return Promise.reject(o)}},t.positionShader=function(){var e=this;return"\n      "+function(){for(var t="",n=e.HEIGHT,o=0;o<n;o++)t+="\n          uniform vec3 mouse"+o.toFixed(0)+";\n        ";return t}()+"\n\n      uniform sampler2D lookup;\n      uniform float time;\n\n\t\t\tvoid main()\t{\n        // const float width = resolution.x;\n        // const float height = resolution.y;\n        // float xID = floor(gl_FragCoord.x);\n        // float yID = floor(gl_FragCoord.y);\n\n        vec2 uvCursor = vec2(gl_FragCoord.x, gl_FragCoord.y) / resolution.xy;\n        // vec4 positionHead = texture2D( texturePosition, uvCursor );\n\n        vec4 lookupData = texture2D(lookup, uvCursor);\n        vec2 nextUV = lookupData.xy;\n        float currentIDX = floor(gl_FragCoord.x);\n        float currentLine = floor(gl_FragCoord.y);\n\n        if (floor(currentIDX) == 0.0) {\n          "+function(){for(var t="if (false) {}",n=e.HEIGHT,o=0;o<n;o++)t+="\n          else if (currentLine == "+o.toFixed(0)+".0) {\n            gl_FragColor = vec4(mouse"+o.toFixed(0)+", 1.0);\n          }\n        ";return t}()+"\n        } else {\n          vec3 positionChain = texture2D( texturePosition,nextUV ).xyz;\n          gl_FragColor = vec4(positionChain, 1.0);\n        }\n\n\n\t\t\t}\n    "},t.fillPositionTexture=function(e){for(var t=0,n=e.image.data,o=0;o<this.HEIGHT;o++)for(var r=0;r<this.WIDTH;r++)n[t++]=0,n[t++]=0,n[t++]=0,n[t++]=0;e.needsUpdate=!0},t.fillLookupTexture=function(e){for(var t=0,n=e.image.data,o=[],r=0;r<this.HEIGHT;r++)for(var a=0;a<this.WIDTH;a++){var i=o[o.length-1]||[0,0];n[t++]=i[0],n[t++]=i[1],n[t++]=this.WIDTH,n[t++]=this.HEIGHT,o.push([a/this.WIDTH,r/this.HEIGHT])}e.needsUpdate=!0},t.render=function(e){var t=this,n=e.trackers;this.positionUniforms.time.value=window.performance.now()/1e3,n.forEach((function(e,n){var o=t.positionUniforms["mouse"+n];o&&o.value&&o.value.copy(e)})),this.gpu.compute()},t.getTextureAfterCompute=function(){return{posTexture:this.gpu.getCurrentRenderTarget(this.positionVariable).texture}},e}(),A=function(){function e(e){var t=e.node,n=e.sim,o=e.mounter,r=e.color;this.mounter=o,this.node=t,this.sim=n,this.color=r,this.wait=this.setup({node:t})}return e.prototype.setup=function(e){var t=e.node;try{var n=this,o=n.mounter,r=new I({count:n.sim.HEIGHT,numSides:4,subdivisions:2*n.sim.WIDTH,openEnded:!1}),a=r.geometry,i=r.subdivisions,c=r.count;a.instanceCount=c;var l=function(e){var t=e.controlPointsResolution,o=void 0===t?20:t,r=e.lineIdx,a=void 0===r?0:r,i=e.lineCount,c=void 0===i?n.sim.HEIGHT:i,l=e.textureName,s=void 0===l?"CONTROL_POINTS":l;o=Math.floor(o);var u=""+Number(o).toFixed(1);return"\n      vec3 pointIDX_"+s+"_"+a.toFixed(0)+" (float index) {\n        vec3 result = vec3(0.0);\n\n        vec4 color = texture2D("+s+",\n          vec2(\n            index / "+o.toFixed(1)+",\n            "+a.toFixed(1)+" / "+c.toFixed(1)+"\n          )\n        );\n\n        result = color.rgb;\n\n        return result;\n      }\n\n      vec3 catmullRom_"+s+"_"+a+" (vec3 p0, vec3 p1, vec3 p2, vec3 p3, float t) {\n          vec3 v0 = (p2 - p0) * 0.5;\n          vec3 v1 = (p3 - p1) * 0.5;\n          float t2 = t * t;\n          float t3 = t * t * t;\n\n          return vec3((2.0 * p1 - 2.0 * p2 + v0 + v1) * t3 + (-3.0 * p1 + 3.0 * p2 - 2.0 * v0 - v1) * t2 + v0 * t + p1);\n      }\n\n      vec3 getPointAt_"+a.toFixed(0)+" (float t) {\n        bool closed = false;\n        float ll = "+u+";\n        float minusOne = 1.0;\n        if (closed) {\n          minusOne = 0.0;\n        }\n\n        float p = (ll - minusOne) * t;\n        float intPoint = floor(p);\n        float weight = p - intPoint;\n\n        float idx0 = intPoint + -1.0;\n        float idx1 = intPoint +  0.0;\n        float idx2 = intPoint +  1.0;\n        float idx3 = intPoint +  2.0;\n\n        vec3 pt0 = pointIDX_"+s+"_"+a.toFixed(0)+"(idx0);\n        vec3 pt1 = pointIDX_"+s+"_"+a.toFixed(0)+"(idx1);\n        vec3 pt2 = pointIDX_"+s+"_"+a.toFixed(0)+"(idx2);\n        vec3 pt3 = pointIDX_"+s+"_"+a.toFixed(0)+"(idx3);\n\n        vec3 pointoutput = catmullRom_"+s+"_"+a+"(pt0, pt1, pt2, pt3, weight);\n\n        return pointoutput;\n      }\n      "},s=(new v.Color).copy(n.color);window.addEventListener("set-tail-color",(function(e){var t=e.detail;s.set(t)})),n.node.onLoop((function(){n.color.lerp(s,.03)}));var u=new v.ShaderMaterial({uniforms:{tailColor:{value:n.color},time:{value:0},matcap:{value:null},posTexture:{value:null}},vertexShader:"\n        // #include <common>\n        #define lengthSegments "+i.toFixed(1)+"\n\n        attribute float angle;\n        attribute float newPosition;\n        attribute float tubeInfo;\n\n        // varying vec2 vUv;\n        varying vec3 vNormal;\n        attribute vec4 offset;\n\n        uniform sampler2D posTexture;\n        // uniform sampler2D handTexture;\n\n        uniform float time;\n\n        mat4 rotationX( in float angle ) {\n          return mat4(\t1.0,\t\t0,\t\t\t0,\t\t\t0,\n                  0, \tcos(angle),\t-sin(angle),\t\t0,\n                  0, \tsin(angle),\t cos(angle),\t\t0,\n                  0, \t\t\t0,\t\t\t  0, \t\t1);\n        }\n\n        mat4 rotationY( in float angle ) {\n          return mat4(\tcos(angle),\t\t0,\t\tsin(angle),\t0,\n                      0,\t\t1.0,\t\t\t 0,\t0,\n                  -sin(angle),\t0,\t\tcos(angle),\t0,\n                      0, \t\t0,\t\t\t\t0,\t1);\n        }\n\n        mat4 rotationZ( in float angle ) {\n          return mat4(\tcos(angle),\t\t-sin(angle),\t0,\t0,\n                  sin(angle),\t\tcos(angle),\t\t0,\t0,\n                      0,\t\t\t\t0,\t\t1,\t0,\n                      0,\t\t\t\t0,\t\t0,\t1);\n        }\n\n        mat4 rotationMatrix (vec3 axis, float angle) {\n            axis = normalize(axis);\n            float s = sin(angle);\n            float c = cos(angle);\n            float oc = 1.0 - c;\n\n            return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,\n                        oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,\n                        oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,\n                        0.0,                                0.0,                                0.0,                                1.0);\n        }\n\n        "+function(){for(var e="",t=0;t<n.sim.HEIGHT;t++)e+=l({lineIdx:t,lineCount:n.sim.HEIGHT,controlPointsResolution:i,textureName:"posTexture"})+"\n";return e}()+"\n\n        vec3 sampleFnc (float t) {\n          vec3 pt = (offset.xyz + 0.5) * 0.0;\n\n          // pt = vec4(vec4(pt, 1.0) * rotationY(t * 0.1 + time * 0.1)).xyz;\n          // if (lineIDXER == 0.0) {\n          //   pt += getPointAt_0(t);\n          // }\n\n          float lineIDXER = offset.w;\n          // pt += getPointAt_0(t);\n\n          "+function(){for(var e="\n          if (false) {}",t=0;t<n.sim.HEIGHT;t++)e+="\n          else if (lineIDXER == "+t.toFixed(1)+") {\n            pt += getPointAt_"+t.toFixed(0)+"(t);\n          }\n        ";return e}()+"\n\n          // pt = getPointAt_2(t);\n\n          return pt;\n        }\n\n        void createTube (float t, vec2 volume, out vec3 pos, out vec3 normal) {\n          // find next sample along curve\n          float nextT = t + (1.0 / lengthSegments);\n\n          // sample the curve in two places\n          vec3 cur = sampleFnc(t);\n          vec3 next = sampleFnc(nextT);\n\n          // compute the Frenet-Serret frame\n          vec3 T = normalize(next - cur);\n          vec3 B = normalize(cross(T, next + cur));\n          vec3 N = -normalize(cross(B, T));\n\n          // extrude outward to create a tube\n          float tubeAngle = angle;\n          float circX = cos(tubeAngle);\n          float circY = sin(tubeAngle);\n\n          // compute position and normal\n          normal.xyz = normalize(B * circX + N * circY);\n          pos.xyz = cur + B * volume.x * circX + N * volume.y * circY;\n        }\n\n        varying float vT;\n        varying vec3 vViewPosition;\n\n        void main (void) {\n          vec3 transformed;\n          vec3 objectNormal;\n\n          float t = tubeInfo + 0.5;\n\n          vT = t;\n\n          vec2 volume = vec2(0.0333, 0.0333) * (1.0 - t) * 2.0;\n          createTube(t, volume, transformed, objectNormal);\n\n          vec3 transformedNormal = normalMatrix * objectNormal;\n          vNormal = normalize(transformedNormal);\n\n          // vUv = uv.yx;\n\n          vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.0);\n          gl_Position = projectionMatrix * mvPosition;\n          vViewPosition = -mvPosition.xyz;\n        }\n      ",fragmentShader:"\n        varying float vT;\n        // varying vec2 vUv;\n        varying vec3 vNormal;\n        varying vec3 vViewPosition;\n        // uniform sampler2D matcap;\n        uniform vec3 tailColor;\n        void main (void) {\n\n          // vec3 viewDir = normalize( vViewPosition );\n          // vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n          // vec3 y = cross( viewDir, x );\n          // vec2 uv = vec2( dot( x, vNormal ), dot( y, vNormal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\n          // vec4 matcapColor = texture2D( matcap, uv );\n\n          vec4 color = vec4((vNormal * vViewPosition), 1.0);\n          gl_FragColor = vec4(tailColor, (1.0 - vT));\n        }\n      ",transparent:!0,depthTest:!1}),f=new v.Mesh(a,u);return f.frustumCulled=!1,f.userData.enableBloom=!0,o.add(f),t.onClean((function(){o.remove(f)})),n.sim.wait.then((function(){t.onLoop((function(){var e=n.sim.getTextureAfterCompute();u.uniforms.posTexture.value=e.posTexture,u.uniforms.time.value=window.performance.now()/1e3}))})),Promise.resolve()}catch(m){return Promise.reject(m)}},e}(),I=function(e){var t=e.count,n=void 0===t?20:t,o=e.numSides,r=void 0===o?4:o,a=e.subdivisions,i=void 0===a?50:a,c=e.openEnded,l=void 0===c||c,s=new v.CylinderBufferGeometry(1,1,1,r,i,l),u=new y.a;(u=u.fromBufferGeometry(s)).rotateZ(Math.PI/2);var f=new v.Vector2,m=[],d=[],p=[],g=u.vertices,x=u.faceVertexUvs[0],h=[];u.faces.forEach((function(e,t){var n=e.a,o=e.b,r=e.c,a=[g[n],g[o],g[r]],i=x[t];a.forEach((function(e,t){f.set(e.y,e.z).normalize();var n=Math.atan2(f.y,f.x);d.push(n),m.push(e.x),h.push(e.x,e.y,e.z),p.push(i[t].toArray())}))}));for(var w=new Float32Array(m),b=new Float32Array(d),E=new Float32Array(2*p.length),D=new Float32Array(h),P=0;P<w.length;P++){var z=p[P],T=z[0],S=z[1];E[2*P+0]=T,E[2*P+1]=S}var C=new v.InstancedBufferGeometry;C.instanceCount=n,C.setAttribute("position",new v.BufferAttribute(D,3)),C.setAttribute("tubeInfo",new v.BufferAttribute(w,1)),C.setAttribute("angle",new v.BufferAttribute(b,1)),C.setAttribute("uv",new v.BufferAttribute(E,2));for(var k=[],j=Math.floor(Math.pow(n,1/3)),A=0,I=0;I<j;I++)for(var O=0;O<j;O++)for(var R=0;R<j;R++)k.push(0,0,0,A),A++;return C.setAttribute("offset",new v.InstancedBufferAttribute(new Float32Array(k),4)),M({},e,{dataLength:w.length,geometry:C})},O=function(e){var t=e.mini,n=e.mounter,o=e.cursor,r=e.color,a=void 0===r?new v.Color("#ffffff"):r,i=t,c=new j({node:i,mounter:n,numberOfScans:8,trailSize:64}),l=new A({node:i,sim:c,mounter:n,color:a});this.display=l;for(var s=[],u=function(e){!function(e){var n=e.update,r=e.setup,a=new v.Object3D;o.add(a),t.onClean((function(){o.remove(a)}));var c=new v.Object3D;a.add(c);var l=new v.Object3D;c.add(l);var u=new v.Vector3,f=new v.Vector3;r({origin:c,orbit:l}),i.onLoop((function(){var e;n({origin:c,orbit:l}),null!==(e=t.now)&&void 0!==e&&e.camera&&a.lookAt(t.now.camera.position),l.getWorldPosition(u),f.lerp(u,.3)})),s.push(f)}({setup:function(t){t.origin.rotation.z+=2*Math.PI/3*e},update:function(e){var t=e.origin,n=e.orbit;t.rotation.z+=.1,n.position.x=.85+.85*Math.sin(window.performance.now()/1e3*1)}})},f=0;f<3;f++)u(f);c.wait.then((function(){i.onLoop((function(){c.render({trackers:s})}))}))};function R(e){var t=e.Now,n=e.color,a=E().mini,i=Object(o.useRef)(),l=Object(o.useRef)(new v.Color(n));return Object(o.useEffect)((function(){l.current.set(n)}),[n]),Object(o.useEffect)((function(){var e=i.current;e&&a.ready.scene.then((function(t){return new O({mini:a,cursor:e,mounter:t,color:l.current})}))}),[]),Object(c.c)((function(e,n){if(i.current){var o=i.current;o.position.lerp(t.cursorPos,.2),o.lookAt(e.camera.position)}})),r.a.createElement("group",{ref:i})}var F=function(e){var t=e.mini,o=t.now.get,r=new v.Vector2;r.copy({x:o().gl.domElement.width,y:o().gl.domElement.height}),r.multiplyScalar(.75);var a=n(58).EffectComposer,i=n(55).RenderPass,c=n(59).UnrealBloomPass,l=new a(o().gl);t.onResize((function(){l.setPixelRatio(.75*o().gl.getPixelRatio())}));var s=new i(o().scene,o().camera);t.onResize((function(){r.copy({x:o().gl.domElement.width,y:o().gl.domElement.height}),r.multiplyScalar(.75),s.setSize(r.x,r.y)})),l.addPass(s);var u=new c(r,1.5,1,.1);t.onResize((function(){r.copy({x:o().gl.domElement.width,y:o().gl.domElement.height}),r.multiplyScalar(.75),u.setSize(r.x,r.y)})),l.addPass(u),l.renderToScreen=!1;var f=new v.Color("#000000"),m=new v.Layers;m.disableAll(),m.enable(0);var d=new v.Layers;d.disableAll(),d.enable(1);var p=new v.Layers;p.disableAll(),p.enable(2);var g=function(e){return function(t){t.uniforms.globalDarkening=e;t.fragmentShader="\n        uniform bool globalDarkening;\n\n      ".trim()+"\n"+t.fragmentShader,t.fragmentShader=t.fragmentShader.replace("#include <dithering_fragment>","#include <dithering_fragment>\n"+"\n        if (globalDarkening) {\n          gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n      ".trim())}},y=new Map,x=new Map,h=function(e){if(!x.has(e.uuid)&&(e.material&&(e.material instanceof v.MeshStandardMaterial||e.material instanceof v.MeshPhongMaterial||e.material instanceof v.MeshBasicMaterial||e.material instanceof v.MeshLambertMaterial||e.material instanceof v.MeshMatcapMaterial||e.material instanceof v.MeshPhysicalMaterial||e.material instanceof v.MeshToonMaterial)&&e.material.onBeforeCompile.toString()!==g.toString())){var t={value:!1};e.userData.globalDarkening=t,x.set(e.uuid,t),e.material.onBeforeCompile=g(t),e.material.needsUpdate=!0}x.has(e.uuid)&&(x.get(e.uuid).value=!0)};this.renderTexture=function(){var e=o().gl;e.shadowMap.enabled=!1,o().scene.traverse((function(e){var t;e.material&&(e.material instanceof v.MeshStandardMaterial||e.material instanceof v.MeshPhongMaterial||e.material instanceof v.MeshBasicMaterial||e.material instanceof v.MeshLambertMaterial||e.material instanceof v.MeshMatcapMaterial||e.material instanceof v.MeshPhysicalMaterial||e.material instanceof v.MeshToonMaterial)&&(y.has(e.uuid+e.material.uuid)||null!==(t=e.material)&&void 0!==t&&t.clone&&(e.material=e.material.clone(),y.set(e.uuid+e.material.uuid,!0)))})),o().scene.traverse((function(e){var t,n,o,r;null!==e&&void 0!==e&&null!==(t=e.userData)&&void 0!==t&&t.discard&&(e.visible=!1),null!==e&&void 0!==e&&null!==(n=e.userData)&&void 0!==n&&n.disableBloom&&(e.visible=!1),e.material&&(null!==e&&void 0!==e&&null!==(o=e.userData)&&void 0!==o&&o.enableDarken?h(e):null!==e&&void 0!==e&&null!==(r=e.userData)&&void 0!==r&&r.enableBloom||!p.test(e.layers)&&d.test(e.layers)||h(e))})),function(){var e=o(),t=e.scene,n=e.clock.getDelta(),r=t.background;t.background=f,l.render(n),t.background=r}(),o().scene.traverse((function(e){var t,n;x.has(e.uuid)&&(x.get(e.uuid).value=!1),null!==e&&void 0!==e&&null!==(t=e.userData)&&void 0!==t&&t.discard&&(e.visible=!0),null!==e&&void 0!==e&&null!==(n=e.userData)&&void 0!==n&&n.disableBloom&&(e.visible=!0)})),e.shadowMap.enabled=!0},this.getTex=function(){return l.readBuffer.texture}},_=function(e){var t=this,n=e.mini,o=n.now,r=o.size,a=o.gl,i=o.get,c=new v.Vector2;c.copy({x:r.width,y:r.height}),c.multiplyScalar(a.getPixelRatio()),this.rtt=new v.WebGLRenderTarget(c.width,c.height,{encoding:v.sRGBEncoding,generateMipmaps:!1}),n.onClean((function(){t.rtt.dispose()})),n.onResize((function(){c.copy({x:i().gl.domElement.width,y:i().gl.domElement.height}),c.multiplyScalar(a.getPixelRatio()),t.rtt=new v.WebGLRenderTarget(c.width,c.height,{encoding:v.sRGBEncoding,generateMipmaps:!1})})),this.renderTexture=function(){var e=i(),n=e.gl,o=e.camera,r=e.scene,a=n.getRenderTarget();n.setRenderTarget(t.rtt),n.render(r,o),n.setRenderTarget(a)},this.getTex=function(){return t.rtt.texture}},B=function(e){var t=e.mini,n=new v.ShaderMaterial({uniforms:{bloomDiffuse:{value:null},baseDiffuse:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main (void) {\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n          vUv = uv;\n        }\n      ",fragmentShader:"\n        uniform sampler2D baseDiffuse;\n        uniform sampler2D bloomDiffuse;\n\n        varying vec2 vUv;\n          void main (void) {\n            vec4 baseDiffuseColor = texture2D(baseDiffuse, vUv);\n            vec4 bloomDiffuseColor = texture2D(bloomDiffuse, vUv);\n\n            gl_FragColor = vec4(baseDiffuseColor.rgb * 1.0,  baseDiffuseColor.a);\n\n            gl_FragColor.r += 0.45 * pow(bloomDiffuseColor.r, 0.75);\n            gl_FragColor.g += 0.45 * pow(bloomDiffuseColor.g, 0.75);\n            gl_FragColor.b += 0.45 * pow(bloomDiffuseColor.b, 0.75);\n          }\n        "}),o=new h.a(n);this.render=function(e){var r=e.baseTex,a=e.bloomTex,i=t.now.gl;i&&(n.uniforms.bloomDiffuse.value=a,n.uniforms.baseDiffuse.value=r,o.render(i))}};function V(){var e=E().mini,t=Object(o.useRef)((function(){}));return Object(o.useEffect)((function(){e.ready.get.then((function(){var n=new _({mini:e}),o=new F({mini:e}),r=new B({mini:e});t.current=function(){n.renderTexture(),o.renderTexture(),r.render({baseTex:n.getTex(),bloomTex:o.getTex()})}}))}),[]),Object(c.c)((function(){t.current()}),1e3),null}function L(){var e={vertexShader:"\n    varying vec3 vPos;\n    varying vec3 vUv3;\n\n    void main() {\n      vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n      gl_Position = projectionMatrix * mvPosition;\n      vPos = position;\n      vUv3 = uv.xyx;\n    }\n    ",fragmentShader:"\n      precision highp float;\n\n      vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}\n      vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}\n      vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}\n\n      float cnoise(vec3 P){\n        vec3 Pi0 = floor(P); // Integer part for indexing\n        vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n        Pi0 = mod(Pi0, 289.0);\n        Pi1 = mod(Pi1, 289.0);\n        vec3 Pf0 = fract(P); // Fractional part for interpolation\n        vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n        vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n        vec4 iy = vec4(Pi0.yy, Pi1.yy);\n        vec4 iz0 = Pi0.zzzz;\n        vec4 iz1 = Pi1.zzzz;\n\n        vec4 ixy = permute(permute(ix) + iy);\n        vec4 ixy0 = permute(ixy + iz0);\n        vec4 ixy1 = permute(ixy + iz1);\n\n        vec4 gx0 = ixy0 / 7.0;\n        vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n        gx0 = fract(gx0);\n        vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n        vec4 sz0 = step(gz0, vec4(0.0));\n        gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n        gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n        vec4 gx1 = ixy1 / 7.0;\n        vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n        gx1 = fract(gx1);\n        vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n        vec4 sz1 = step(gz1, vec4(0.0));\n        gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n        gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n        vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n        vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n        vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n        vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n        vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n        vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n        vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n        vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n        vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n        g000 *= norm0.x;\n        g010 *= norm0.y;\n        g100 *= norm0.z;\n        g110 *= norm0.w;\n        vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n        g001 *= norm1.x;\n        g011 *= norm1.y;\n        g101 *= norm1.z;\n        g111 *= norm1.w;\n\n        float n000 = dot(g000, Pf0);\n        float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n        float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n        float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n        float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n        float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n        float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n        float n111 = dot(g111, Pf1);\n\n        vec3 fade_xyz = fade(Pf0);\n        vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n        vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n        float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n        return 2.2 * n_xyz;\n      }\n\n      varying vec3 vPos;\n      uniform float time;\n      varying vec3 vUv3;\n\n      void main() {\n        float speed = time / 3.5;\n        vec3 pp;\n        pp = vUv3.xyx * 600.0 + speed;\n        // pp += vPos * 0.25 + speed;\n        float noise = clamp(cnoise(speed + pp / 250.0 + 0.0 ), 0.0, 1.0);\n\n        vec3 colorA = vec3(81.0, 135.0, 228.0) * 0.2 / 255.0;\n        vec3 colorB = vec3(0.0, 150.0, 136.0) * 0.2 / 255.0;\n\n        vec4 backgroundColor = vec4(mix(colorA, colorB, noise), 1.0);\n\n        gl_FragColor = backgroundColor;\n\n        float starNoise = (noise) * pow(cnoise(speed + pp * 2.0) * 0.5 + 0.5, 15.5) * 30.0;\n\n        gl_FragColor.rgb += vec3(pow(starNoise, 1.3)) * 1.5;\n      }\n      "},t=Object(o.useRef)();Object(o.useEffect)((function(){t.current&&(t.current.needsUpdate=!0)}),[e,e.fragmentShader,e.vertexShader]);var n=Object(o.useRef)({time:{value:0}});return Object(c.c)((function(){n.current.time.value+=1/60})),r.a.createElement(p.a,{frustumCulled:!1,userData:{enableBloom:!0},scale:1,args:[800,20,20]},r.a.createElement("shaderMaterial",{ref:t,uniforms:n.current,fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,side:v.DoubleSide}))}function N(e){var t,n=e.Now;n.makeKeyReactive("tooltip");var o=Object(c.e)().camera;return Object(c.b)(r.a.createElement("group",{position:[.03,-.03,-3]},r.a.createElement(g.a,{anchorX:"left",anchorY:"top",userData:{disableBloom:!0},outlineWidth:.003,fontSize:.06},null!==(t=n.hoverData)&&void 0!==t&&t.website?"Click to Open:\n":"",n.tooltip||"")),o)}function H(e){var t=e.Now;return r.a.createElement("group",null,r.a.createElement(U,{Now:t}),r.a.createElement(G,{Now:t}),r.a.createElement(N,{Now:t}),r.a.createElement(X,null))}function U(e){var t=e.Now,n=Object(o.useRef)(),a=Object(o.useRef)();return Object(c.c)((function(e){var t=e.camera;n.current&&(n.current.position.copy(t.position),n.current.rotation.copy(t.rotation))})),r.a.createElement("group",null,r.a.createElement("group",{ref:n},r.a.createElement("group",{ref:a,scale:[1,1,1],position:[0,0,-1]},r.a.createElement("group",{scale:.001,rotation:[0,0,.25*Math.PI]},r.a.createElement(W,{Now:t},r.a.createElement("mesh",{position:[0,-4.5,0]},r.a.createElement("coneBufferGeometry",{args:[4,9,3,1]}),r.a.createElement("meshBasicMaterial",{color:"#000000"})),r.a.createElement("mesh",{position:[0,-11,0]},r.a.createElement("boxBufferGeometry",{args:[2,5,2]}),r.a.createElement("meshBasicMaterial",{color:"#000000"})))))))}function W(e){var t=e.Now,n=e.children,a=Object(o.useRef)();return Object(c.c)((function(e){var n=e.clock.getElapsedTime();if(a.current){var o,r=0;null!==t&&void 0!==t&&null!==(o=t.hoverData)&&void 0!==o&&o.website&&(r=3*Math.cos(5*n)-3),a.current.position.y=v.MathUtils.lerp(a.current.position.y,r,.5)}})),r.a.createElement("group",{ref:a},n)}function G(e){var t=e.Now,n=Object(c.e)().gl,o=0,r=!1;return D("pointerdown",(function(){r=!0,o=0}),{passive:!1},n.domElement),D("pointerup",(function(){r=!1}),{passive:!1},n.domElement),D("pointermove",(function(){r&&o++}),{passive:!1},n.domElement),D("pointerup",(function(){var e;if(t&&o<=10&&(null!==t&&void 0!==t&&null!==(e=t.hoverData)&&void 0!==e&&e.website)){var n=document.createElement("a");n.href=t.hoverData.website,n.target="_blank",n.click()}}),{passive:!1},n.domElement),null}function X(){return D("pointerdown",(function(){document.body.style.cursor="none"}),{passive:!1},document.body),D("pointerup",(function(){document.body.style.cursor="grabbing"}),{passive:!1},document.body),Object(o.useEffect)((function(){return document.body.style.cursor="grabbing",function(){document.body.style.cursor=""}}),[]),null}var J="https://wonglok.github.io/effectnode-3dworld/";function Y(){var e=Object(l.a)("".concat(J,"map/demo-map-000.glb"));return r.a.createElement("group",null,e.scene&&r.a.createElement(C,{object:e.scene},(function(e){var t=e.Now;return r.a.createElement("group",null,r.a.createElement(k,{higherCamera:1.5,avatarSpeed:2,Now:t}),r.a.createElement(R,{Now:t,color:"#bababa"}),r.a.createElement(H,{Now:t}))})),r.a.createElement(V,null),r.a.createElement(q,{imageURL:"".concat(J,"image/sky.png")}),r.a.createElement(L,null))}function q(e){var t=e.imageURL,n=Object(s.a)(t),r=Object(c.e)().get,a=function(e,t,n,r){void 0===e&&(e=S),void 0===t&&(t={}),void 0===n&&(n=128),void 0===r&&(r=1/0);var a=Object(c.e)().get,i=Object(o.useMemo)((function(){var o=a().gl,r=new v.Scene,i={uniforms:M({},t,{time:{value:.5}}),vertexShader:"\n        varying vec3 vWorldDirection;\n        vec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n          return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n        }\n        void main() {\n          vWorldDirection = transformDirection( position, modelMatrix );\n          #include <begin_vertex>\n          #include <project_vertex>\n        }\n      ",fragmentShader:"\n      varying vec3 vWorldDirection;\n\n\n        #define RECIPROCAL_PI 0.31830988618\n        #define RECIPROCAL_PI2 0.15915494\n\n        uniform float time;\n        "+(e||S)+"\n\n        void main() {\n          vec3 direction = normalize( vWorldDirection );\n          vec2 sampleUV;\n          sampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n          sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\n          gl_FragColor = mainImage(sampleUV);\n\n        }\n      "},c=new v.ShaderMaterial({type:"CubemapFromEquirect",uniforms:i.uniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:v.BackSide,blending:v.NoBlending}),l=new v.Mesh(new v.BoxBufferGeometry(5,5,5),c);r.add(l);var s=new v.WebGLCubeRenderTarget(n,{format:v.RGBFormat,generateMipmaps:!0,magFilter:v.LinearFilter,minFilter:v.LinearMipmapLinearFilter}),u=new v.CubeCamera(1,1e5,s);i.uniforms.time.value=.4,u.update(o,r);return s.texture.mapping=v.CubeRefractionMapping,s.texture.mapping=v.CubeReflectionMapping,s.texture.encoding=v.sRGBEncoding,{envMap:s.texture,compute:function(){i.uniforms.time.value+=1/60,u.update(o,r)}}}),[e]),l=i.envMap,s=i.compute,u=0;return Object(c.c)((function(){u<=r&&(u++,s())})),l}("\n      const mat2 m = mat2( 0.80,  0.60, -0.60,  0.80 );\n\n      float noise( in vec2 p ) {\n        return sin(p.x)*sin(p.y);\n      }\n\n      float fbm4( vec2 p ) {\n          float f = 0.0;\n          f += 0.5000 * noise( p ); p = m * p * 2.02;\n          f += 0.2500 * noise( p ); p = m * p * 2.03;\n          f += 0.1250 * noise( p ); p = m * p * 2.01;\n          f += 0.0625 * noise( p );\n          return f / 0.9375;\n      }\n\n      float fbm6( vec2 p ) {\n          float f = 0.0;\n          f += 0.500000*(0.5 + 0.5 * noise( p )); p = m*p*2.02;\n          f += 0.250000*(0.5 + 0.5 * noise( p )); p = m*p*2.03;\n          f += 0.125000*(0.5 + 0.5 * noise( p )); p = m*p*2.01;\n          f += 0.062500*(0.5 + 0.5 * noise( p )); p = m*p*2.04;\n          f += 0.031250*(0.5 + 0.5 * noise( p )); p = m*p*2.01;\n          f += 0.015625*(0.5 + 0.5 * noise( p ));\n          return f/0.96875;\n      }\n\n      float pattern (vec2 p) {\n        float vout = fbm4( p + time + fbm6(  p + fbm4( p + time )) );\n        return abs(vout);\n      }\n\n      uniform sampler2D textureBG;\n\n      vec4 mainImage (vec2 uv) {\n        vec4 bg = texture2D(textureBG, uv);\n\n        vec3 rainbow = vec3(\n          0.35 + pattern(uv * 1.70123 + -0.17 * cos(time * 0.05)),\n          0.35 + pattern(uv * 1.70123 +  0.0 * cos(time * 0.05)),\n          0.35 + pattern(uv * 1.70123 +  0.17 * cos(time * 0.05))\n        );\n\n        return vec4(rainbow.xyz, 1.0);\n      }\n  ".trim(),{textureBG:{value:n}},128);return Object(o.useEffect)((function(){var e=r().scene;return e.environment=a,function(){e.environment=null}}),[a,r]),null}function K(){return r.a.createElement("group",null,r.a.createElement("group",{"rotation-x":0*Math.PI},r.a.createElement("gridHelper",{args:[150,50,2302755,12237498]})),r.a.createElement(u.a,{position:[0,30,30],"rotation-x":-.25*Math.PI,makeDefault:!0}))}var Z=function(){return r.a.createElement(c.a,{dpr:[0,1.5],style:{width:"100%",height:"100%"}},r.a.createElement(o.Suspense,{fallback:r.a.createElement(K,null)},r.a.createElement(Y,null)))};i.a.render(r.a.createElement(Z,null),document.getElementById("root"))}},[[42,1,2]]]);
//# sourceMappingURL=main.bab37ef9.chunk.js.map